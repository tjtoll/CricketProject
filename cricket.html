<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<style>

#yearFilterSelection{
    position:absolute;
    top:10px;
    left:550px;
}

</style>



<div class="container" id="field">
</div>

<div class="container" id="batArea">
</div>

<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="//code.jquery.com/jquery-1.10.2.js"></script>

<select id="yearFilterSelection"></select>

<script type="text/javascript">



    var fieldSVGHeight = 600;
    var fieldSVGWidth = 500;
    var cricketField = d3.select("#field").append("svg")
        .attr("width", fieldSVGWidth)
        .attr("height", fieldSVGHeight)
        .call(d3.behavior.zoom().on("zoom", function () {
            cricketField.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
        }))
        .append('g');

    d3.csv("cricketdummy.csv", function(cricketdummy){


        // populating the years in the filter drop down
        d3.select("#yearFilterSelection")
            .selectAll('myOptions')
            .data(d3.map(cricketdummy, function(d){return d.Year;}).keys())
            .enter()
            .append('option')
            .text(function(d){return d;})
            .attr("value",function(d){return d;});
        // changing the area scores based on the year selection
        d3.select("#yearFilterSelection").on("change", function(d) {
            var selectedOption = d3.select(this).property("value");

            var batScore = d3.nest()
                .key(function(d) { return d.Year;})
                .rollup(function(d) {
                    return d3.sum(d, function(d) {return d.BatScore; });
                }).entries(cricketdummy.filter(function(d){return d.Year == selectedOption;}));

            var u = cricketField.select("#barScoreCircle")
                .data(batScore)
                .attr("r",function (d) {
                    return d.values
                })
        });
        // aggregating the bat score data by year
        var batScore = d3.nest()
            .key(function(d) { return d.Year;})
            .rollup(function(d) {
                return d3.sum(d, function(d) {return d.BatScore; });
            }).entries(cricketdummy.filter(function(d){return d.Year == d3.select("#yearFilterSelection").property("value");}));

        console.log(batScore);

        function drawCricketField() {
            //Position of Field
            var d = document.getElementById('field');
            d.style.position = "absolute";
            d.style.left = 25+'px';
            d.style.top = 25+'px';
            //Field size variables
            var outfieldShapeFactor = 1.09;
            var infieldShapeFactor = 1.04;
            var centerOfFieldFactor = 2;
            var fieldWhiteBorderWidths = 4;
            var pitchWidth = (fieldSVGWidth/12);
            var pitchHeight = (fieldSVGHeight/5);
            var closeInfieldOffset = 35;
            var closeInfieldLineLength = 75;

            var outfieldBase = cricketField.append("ellipse")
                .attr("cx", fieldSVGWidth/centerOfFieldFactor)
                .attr("cy", fieldSVGHeight/centerOfFieldFactor)
                .attr("rx", fieldSVGWidth/2)
                .attr("ry", (fieldSVGHeight/2)/outfieldShapeFactor )
                .attr("fill",  "#008451");

            var outfieldBaseWhiteBorder = cricketField.append("ellipse")
                .attr("cx", fieldSVGWidth/centerOfFieldFactor)
                .attr("cy", fieldSVGHeight/centerOfFieldFactor)
                .attr("rx", fieldSVGWidth/2.06)
                .attr("ry", (fieldSVGHeight/2.06)/outfieldShapeFactor )
                .attr("fill",  "none")
                .attr("stroke", "#f6f9f9")
                .style("stroke-width", fieldWhiteBorderWidths)


            var infieldBase = cricketField.append("ellipse")
                .attr("cx", fieldSVGWidth/centerOfFieldFactor)
                .attr("cy", fieldSVGHeight/centerOfFieldFactor)
                .attr("rx", fieldSVGWidth/3.25)
                .attr("ry", (fieldSVGHeight/3.25)/infieldShapeFactor )
                .attr("fill",  "#00902e");

            var infieldBaseWhiteBorder = cricketField.append("ellipse")
                .attr("cx", fieldSVGWidth/centerOfFieldFactor)
                .attr("cy", fieldSVGHeight/centerOfFieldFactor)
                .attr("rx", fieldSVGWidth/3.25)
                .attr("ry", (fieldSVGHeight/3.25)/infieldShapeFactor )
                .attr("fill",  "none")
                .attr("stroke", "#f6f9f9")
                .style("stroke-width", fieldWhiteBorderWidths)

            var closeinfieldTop = cricketField.append("circle")
                .attr("id","closeinfieldTop")
                .attr("cx", fieldSVGWidth/centerOfFieldFactor)
                .attr("cy", fieldSVGHeight/centerOfFieldFactor - closeInfieldOffset)
                .attr("r", fieldSVGWidth/11)
                .attr("fill",  "none")
                .style("stroke-dasharray", ("10,3"))
                .attr("stroke", "#f6f9f9")
                .style("stroke-width", 2);

            var closeinfieldBottom = cricketField.append("circle")
                .attr("cx", fieldSVGWidth/centerOfFieldFactor)
                .attr("cy", fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset)
                .attr("r", fieldSVGWidth/11)
                .attr("fill",  "none")
                .attr("stroke", "#f6f9f9")
                .style("stroke-dasharray", ("10,3"))
                .style("stroke-width", 2);

            var pitchArea = cricketField.append("rect")
                .attr("x", (fieldSVGWidth/centerOfFieldFactor) - pitchWidth/2)
                .attr("y", (fieldSVGHeight/centerOfFieldFactor) - pitchHeight/2)
                .attr("width", pitchWidth)
                .attr("height", pitchHeight)
                .attr("fill",  "#fff16e")
                .attr("stroke", "#f6f9f9")
                .style("stroke-width", .5);


            var closeInfieldTopLine = cricketField.append("line")
                .attr("x1", (fieldSVGWidth/centerOfFieldFactor - closeInfieldLineLength) )
                .attr("y1", (fieldSVGHeight/centerOfFieldFactor - closeInfieldOffset) )
                .attr("x2", (fieldSVGWidth/centerOfFieldFactor + closeInfieldLineLength) )
                .attr("y2", (fieldSVGHeight/centerOfFieldFactor - closeInfieldOffset) )
                .attr("stroke", "#f6f9f9")
                .style("stroke-width", 1.5);

            var closeInfieldBottomLine = cricketField.append("line")
                .attr("x1", (fieldSVGWidth/centerOfFieldFactor - closeInfieldLineLength) )
                .attr("y1", (fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset) )
                .attr("x2", (fieldSVGWidth/centerOfFieldFactor + closeInfieldLineLength) )
                .attr("y2", (fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset) )
                .attr("stroke", "#f6f9f9")
                .style("stroke-width", 1.5);

            var batScoreArea = cricketField.append("circle")
                .data(batScore)
                .attr("id","barScoreCircle")
                .attr("cx", fieldSVGWidth/centerOfFieldFactor )
                .attr("cy", fieldSVGHeight/centerOfFieldFactor - closeInfieldOffset - 15)
                .attr("r", function (d) {
                    return d.values
                })
                .attr("fill",  "none")
                .attr("stroke", "#2025c5")
                //.style("stroke-dasharray", ("10,3"))
                .style("stroke-width", 2);

            var batScoreAreaLabel = cricketField.append("text")
                .attr("x", fieldSVGWidth/centerOfFieldFactor)
                .attr("y", fieldSVGHeight/centerOfFieldFactor - closeInfieldOffset - 50)
                .attr("text-anchor", "middle")
                .style("font-size", "12px")
                .style("fill", "#f6f9f9")
                .style("font-family", "Helvetica")
                .text("Batting");

            var bowlScoreAreaLabel = cricketField.append("text")
                .attr("x", fieldSVGWidth/centerOfFieldFactor)
                .attr("y", fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset + 60)
                .attr("text-anchor", "middle")
                .style("font-size", "12px")
                .style("fill", "#f6f9f9")
                .style("font-family", "Helvetica")
                .text("Bowling");

        }
        drawCricketField();

        function scoreAreas() {
            var data = [
                {start: -.5 * Math.PI, size: 1 * Math.PI, color: "red", startbottom: .5 * Math.PI},
            ];
            var arcTop = d3.svg.arc()
                .innerRadius(0)
                .outerRadius(43)
                .startAngle(function(d){return d.start;})
                .endAngle(function(d){return d.start + d.size;});

            var chart = cricketField.append("svg")
                .attr("width", 420)
                .attr("height", 420).append("svg:g")
                .attr("transform", "translate(250,264)");

            chart.selectAll("path")
                .data(data)
                .enter().append("svg:path")
                .style("opacity", .5)
                .style("fill", function(d){
                    return d.color;
                })
                .attr("d", arcTop);

            var arcBottom = d3.svg.arc()
                .innerRadius(0)
                .outerRadius(43)
                .startAngle(function(d){return d.startbottom;})
                .endAngle(function(d){return d.startbottom + d.size;})
            ;

            var chartBottom = cricketField.append("svg")
                .attr("width", 420)
                .attr("height", 420).append("svg:g")
                .attr("transform", "translate(250,336)")
            ;

            chartBottom.selectAll("path")
                .data(data)
                .enter().append("svg:path")
                .style("opacity", .5)
                .style("fill", function(d){
                    return d.color;
                })
                .attr("d", arcBottom)
        }
        scoreAreas();


    console.log(batScore)


    });



</script>
</body>
</html>
