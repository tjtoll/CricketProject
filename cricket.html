<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cricket!</title>
</head>
<body>
<style>

#yearFilterSelection{
    position:absolute;
    bottom:70px;
    left:150px;}

#batMeasureFilterSelection{
    position:absolute;
    bottom:70px;
    left:210px;}

#bowlMeasureFilterSelection{
    position:absolute;
    bottom:70px;
    left:380px;}

#yearFilterTitle{
    position:absolute;
    bottom:90px;
    left:150px;
    font-family: sans-serif;
    font-size: 12px;}

#batMeasureFilterTitle{
    position:absolute;
    bottom:90px;
    left:210px;
    font-family: sans-serif;
    font-size: 12px;}

#bowlMeasureFilterTitle{
    position:absolute;
    bottom:90px;
    left:380px;
    font-family: sans-serif;
    font-size: 12px;}

#teamFilterSelection{
    position:absolute;
    top:45px;
    left:225px;
    font-family: sans-serif;
    font-size: 18px;
}

#teamFilterTitle{
    position:absolute;
    top:45px;
    left:100px;
    font-family: sans-serif;
    font-size: 18px;}

p {
    text-align:center;
    font-family: sans-serif;
    font-size: 18px;
    border-bottom: 3px double;
}
#content img {
    position: absolute;
    top: 0px;
    right: 0px;
}


#area5{
    position:absolute;
    bottom:30px;
    left:5px;}



#scatterMeasureFilterSelection{
    position:absolute;
    top:65px;
    left:1200px;}

#scatterPlot{
    position:absolute;
    top:300px;
    left:650px;}

</style>

<div id="content">
    <img src="ipl.png" class="ribbon" width="75"/>
    <div><p> Project 2 for H517 Visualization Design, Analysis,
        & Evaluation</p></div>
</div>

<div class="container" id="field">
</div>

<div class="container" id="scatterPlot">
</div>

<div class="container" id="batArea">
</div>
<div class="container" id="area5">
</div>

<div id="yearFilterTitle">
    <div>Year</div>
</div>

<div id="batMeasureFilterTitle">
    <div>Batting Measure</div>
</div>

<div id="bowlMeasureFilterTitle">
    <div>Bowling Measure</div>
</div>

<div id="teamFilterTitle">
    <div>Select a team:</div>
</div>

<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="//code.jquery.com/jquery-1.10.2.js"></script>

<select id="yearFilterSelection"></select>
<select id="teamFilterSelection"></select>
<select id="bowlMeasureFilterSelection"></select>
<select id="batMeasureFilterSelection"></select>
<select id="scatterMeasureFilterSelection"></select>


<script type="text/javascript">



    var fieldSVGHeight = 600;
    var scoreAreaOpacity = .60;
    var fieldSVGWidth = 500;
    var outfieldShapeFactor = 1.09;
    var infieldShapeFactor = 1.04;
    var centerOfFieldFactor = 2;
    var fieldWhiteBorderWidths = 4;
    var pitchWidth = (fieldSVGWidth/12);
    var pitchHeight = (fieldSVGHeight/5);
    var closeInfieldOffset = 35;
    var closeInfieldLineLength = 75;
    var selectedOption = 2014;
    var cricketField = d3.select("#field").append("svg")
        .attr("width", fieldSVGWidth)
        .attr("height", fieldSVGHeight)
        .call(d3.behavior.zoom().on("zoom", function () {
            cricketField.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
        }))
        .append('g');
    var svgMapLegend = d3.select("#area5").append("svg")
        .attr("width", 150)
        .attr("height", 125)
        .append('g');

    function drawMapLegend() {
        d3.csv("legend.csv", function (mapLegend) {

            svgMapLegend.selectAll("legends")
                .data(mapLegend)
                .enter()
                .append("circle")
                .attr("cy", function (d, i) {
                    return (d.a * 25)
                        ;
                })
                .attr("cx", 15)
                .attr("r", 6)
                .attr("fill", function (d, i) {
                    if (d.a == 1) {
                        return "#0571b0"
                    }
                    if (d.a == 2) {
                        return "#92c5de"
                    }
                    if (d.a == 3) {
                        return "#ca0020"
                    }
                    if (d.a == 4) {
                        return "#f4a582"
                    }
                    ;
                });

            svgMapLegend.selectAll("legends")
                .data(mapLegend)
                .enter()
                .append("text")
                .attr("y", function (d, i) {
                    return (d.a * 25) + 5
                        ;
                })
                .attr("x", 25)
                .style("font-size", "12px")
                .style("fill", "black")
                .style("font-family", "sans-serif")
                .text(function (d) {
                    return d.b
                });


        });
    }




    d3.csv("cricketPivot.csv", function(cricketdummy){

            d3.select("#batMeasureFilterSelection")
                .selectAll('myOptions')
                .data(d3.map(cricketdummy, function(d){ if (d.MeasureType  == "Batting" ) { return d.MeasureName }
                else { return "Innings" }
                    ; }).keys())
                .enter()
                .append('option')
                .text(function(d){return d;})
                .attr("value",function(d){return d;});

            d3.select("#bowlMeasureFilterSelection")
                .selectAll('myOptions')
                .data(d3.map(cricketdummy, function(d){ if (d.MeasureType  == "Bowling" ) { return d.MeasureName }
                else { return "BowlingEconomy" }
                    ; }).keys())
                .enter()
                .append('option')
                .text(function(d){return d;})
                .attr("value",function(d){return d;});

        d3.select("#scatterMeasureFilterSelection")
            .selectAll('myOptions')
            .data(d3.map(cricketdummy, function(d){ return d.MeasureName }).keys())
            .enter()
            .append('option')
            .text(function(d){return d;})
            .attr("value",function(d){return d;});


        // populating the years in the filter drop down
        d3.select("#yearFilterSelection")
            .selectAll('myOptions')
            .data(d3.map(cricketdummy, function(d){return d.Year;}).keys())
            .enter()
            .append('option')
            .text(function(d){return d;})
            .attr("value",function(d){return d;});
        // populating the teams in the filter drop down
        d3.select("#teamFilterSelection")
            .selectAll('myOptions')
            .data(d3.map(cricketdummy, function(d){return d.Team;}).keys())
            .enter()
            .append('option')
            .text(function(d){return d;})
            .attr("value",function(d){return d;});
        // changing the area scores based on the year selection

        function aggregateData(){
            //#batMeasureFilterSelection
           var dataAggregation = d3.nest()
                .key(function(d) { return d.Year;})
                .rollup(function(d) { return {
                    BatScoreAggAvg: d3.mean(d, function(d) { if (d.MeasureName  == d3.select("#batMeasureFilterSelection").property("value")) { return d.MeasureValue }
                    else { return null }
                        ; }),
                    BatScoreAggSd: d3.deviation(d, function(d) { if (d.MeasureName  == d3.select("#batMeasureFilterSelection").property("value")) { return d.MeasureValue }
                    else { return null }
                        ; }),
                    BatScore: d3.sum(d, function(d) { if (d.Team  == d3.select("#teamFilterSelection").property("value") && d.MeasureName  == d3.select("#batMeasureFilterSelection").property("value")) { return d.MeasureValue }
                    else { return 0 }
                        ; }),
                    BowlScoreAggAvg: d3.mean(d, function(d) { if (d.MeasureName  == d3.select("#bowlMeasureFilterSelection").property("value")) { return d.MeasureValue }
                    else { return null }
                        ; }),
                    BowlScoreAggSd: d3.deviation(d, function(d) { if (d.MeasureName  == d3.select("#bowlMeasureFilterSelection").property("value")) { return d.MeasureValue }
                    else { return null }
                        ; }),
                    BowlScore: d3.sum(d, function(d) { if (d.Team  == d3.select("#teamFilterSelection").property("value") && d.MeasureName  == d3.select("#bowlMeasureFilterSelection").property("value")) { return d.MeasureValue }
                    else { return 0 }
                        ; }),
                    FieldingScoreAggAvg: d3.mean(d, function(d) { return d.MeasureValue; }),
                    FieldingScoreAggSd: d3.deviation(d, function(d) { return d.MeasureValue; }),
                    FieldingScore: d3.sum(d, function(d) { if (d.Team  == d3.select("#teamFilterSelection").property("value") ) { return d.MeasureValue }
                    else { return 0 }
                        ; })

                }; }).entries(filteredToYear);
            return dataAggregation
        }

        function aggregateDataScatter(){
            filteredToTeam = cricketdummy.filter(function(d){return d.Team == d3.select("#teamFilterSelection").property("value");});
            var dataAggregation = d3.nest()
                .key(function(d) { return d.Year;})
                .rollup(function(d) { return {
                    MatchesWon: d3.sum(d, function(d) { if (d.MeasureName  == "MatchesWon" ) { return d.MeasureValue }
                    else { return 0 }
                        ; }),
                    ScatterMeasure: d3.sum(d, function(d) { if (d.MeasureName  == "AverageOfRunsScored" ) { return d.MeasureValue }
                    else { return 0 }
                        ; })

                }; }).entries(filteredToTeam);
            return dataAggregation
        }
        function getBatScoreColor(batScore)
        {
            var batScoreColor;
            // color is based on standard deviation
            if (batScore[0].values.BatScore > batScore[0].values.BatScoreAggSd + batScore[0].values.BatScoreAggAvg) {
                batScoreColor = "#0571b0";
            }
            else if (batScore[0].values.BatScore >= batScore[0].values.BatScoreAggAvg) {
                batScoreColor = "#92c5de";
            }
            else if (batScore[0].values.BatScore < batScore[0].values.BatScoreAggSd - batScore[0].values.BatScoreAggAvg) {
                batScoreColor = "#ca0020";
            }
            else if (batScore[0].values.BatScore <= batScore[0].values.BatScoreAggAvg) {
                batScoreColor = "#f4a582";
            }
            return batScoreColor
        }
        function getBowlScoreColor(batScore)
        {
            var BowlScoreColor;
            // color is based on standard deviation
            if (batScore[0].values.BowlScore > batScore[0].values.BowlScoreAggSd + batScore[0].values.BowlScoreAggAvg) {
                BowlScoreColor = "#0571b0";
            }
            else if (batScore[0].values.BowlScore >= batScore[0].values.BowlScoreAggAvg) {
                BowlScoreColor = "#92c5de";
            }
            else if (batScore[0].values.BowlScore < batScore[0].values.BowlScoreAggSd - batScore[0].values.BowlScoreAggAvg) {
                BowlScoreColor = "#ca0020";
            }
            else if (batScore[0].values.BowlScore <= batScore[0].values.BowlScoreAggAvg) {
                BowlScoreColor = "#f4a582";
            }
            return BowlScoreColor
        }
        function getFieldingScoreColor(batScore)
        {
            var FieldingScoreColor;
            // color is based on standard deviation
            if (batScore[0].values.FieldingScore > batScore[0].values.FieldingScoreAggSd + batScore[0].values.FieldingScoreAggAvg) {
                FieldingScoreColor = "#0571b0";
            }
            else if (batScore[0].values.FieldingScore >= batScore[0].values.FieldingScoreAggAvg) {
                FieldingScoreColor = "#92c5de";
            }
            else if (batScore[0].values.FieldingScore < batScore[0].values.FieldingScoreAggSd - batScore[0].values.FieldingScoreAggAvg) {
                FieldingScoreColor = "#ca0020";
            }
            else if (batScore[0].values.FieldingScore <= batScore[0].values.FieldingScoreAggAvg) {
                FieldingScoreColor = "#f4a582";
            }
            return FieldingScoreColor

        }
        // aggregating the bat score data by year
        filteredToYear = cricketdummy.filter(function(d){return d.Year == selectedOption;});
        var batScore = aggregateData()
        console.log(batScore);
        var batScoreColor = getBatScoreColor(batScore)
        var bowlScoreColor = getBowlScoreColor(batScore)

        function drawCricketField() {
            //Position of Field
            var d = document.getElementById('field');
            d.style.position = "absolute";
            d.style.left = 15+'px';
            d.style.top = 45+'px';
            //Field size variables


            var outfieldBase = cricketField.append("ellipse")
                .attr("cx", fieldSVGWidth/centerOfFieldFactor)
                .attr("cy", fieldSVGHeight/centerOfFieldFactor)
                .attr("rx", fieldSVGWidth/2)
                .attr("ry", (fieldSVGHeight/2)/outfieldShapeFactor )
                .attr("fill",  "#008451");


            var outfieldBaseWhiteBorder = cricketField.append("ellipse")
                .attr("cx", fieldSVGWidth/centerOfFieldFactor)
                .attr("cy", fieldSVGHeight/centerOfFieldFactor)
                .attr("rx", fieldSVGWidth/2.06)
                .attr("ry", (fieldSVGHeight/2.06)/outfieldShapeFactor )
                .attr("fill",  "none")
                .attr("stroke", "#f6f9f9")
                .style("stroke-width", fieldWhiteBorderWidths)


            var infieldBase = cricketField.append("ellipse")
                .attr("cx", fieldSVGWidth/centerOfFieldFactor)
                .attr("cy", fieldSVGHeight/centerOfFieldFactor)
                .attr("rx", fieldSVGWidth/3.25)
                .attr("ry", (fieldSVGHeight/3.25)/infieldShapeFactor )
                .attr("fill",  "#00902e");

            var infieldBaseWhiteBorder = cricketField.append("ellipse")
                .attr("cx", fieldSVGWidth/centerOfFieldFactor)
                .attr("cy", fieldSVGHeight/centerOfFieldFactor)
                .attr("rx", fieldSVGWidth/3.25)
                .attr("ry", (fieldSVGHeight/3.25)/infieldShapeFactor )
                .attr("fill",  "none")
                .attr("stroke", "#f6f9f9")
                .style("stroke-width", fieldWhiteBorderWidths)

            var closeinfieldTop = cricketField.append("circle")
                .attr("id","closeinfieldTop")
                .attr("cx", fieldSVGWidth/centerOfFieldFactor)
                .attr("cy", fieldSVGHeight/centerOfFieldFactor - closeInfieldOffset)
                .attr("r", fieldSVGWidth/11)
                .attr("fill",  "none")
                .style("stroke-dasharray", ("10,3"))
                .attr("stroke", "#f6f9f9")
                .style("stroke-width", 2);

            var closeinfieldBottom = cricketField.append("circle")
                .attr("cx", fieldSVGWidth/centerOfFieldFactor)
                .attr("cy", fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset)
                .attr("r", fieldSVGWidth/11)
                .attr("fill",  "none")
                .attr("stroke", "#f6f9f9")
                .style("stroke-dasharray", ("10,3"))
                .style("stroke-width", 2);

            var pitchArea = cricketField.append("rect")
                .attr("x", (fieldSVGWidth/centerOfFieldFactor) - pitchWidth/2)
                .attr("y", (fieldSVGHeight/centerOfFieldFactor) - pitchHeight/2)
                .attr("width", pitchWidth)
                .attr("height", pitchHeight)
                .attr("fill",  "#fff16e")
                .attr("stroke", "#f6f9f9")
                .style("stroke-width", .5);


            var closeInfieldTopLine = cricketField.append("line")
                .attr("x1", (fieldSVGWidth/centerOfFieldFactor - closeInfieldLineLength) )
                .attr("y1", (fieldSVGHeight/centerOfFieldFactor - closeInfieldOffset) )
                .attr("x2", (fieldSVGWidth/centerOfFieldFactor + closeInfieldLineLength) )
                .attr("y2", (fieldSVGHeight/centerOfFieldFactor - closeInfieldOffset) )
                .attr("stroke", "#f6f9f9")
                .style("stroke-width", 1.5);

            var closeInfieldBottomLine = cricketField.append("line")
                .attr("x1", (fieldSVGWidth/centerOfFieldFactor - closeInfieldLineLength) )
                .attr("y1", (fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset) )
                .attr("x2", (fieldSVGWidth/centerOfFieldFactor + closeInfieldLineLength) )
                .attr("y2", (fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset) )
                .attr("stroke", "#f6f9f9")
                .style("stroke-width", 1.5);


            var batScoreAreaLabel = cricketField.append("text")
                .attr("x", fieldSVGWidth/centerOfFieldFactor - 55)
                .attr("y", fieldSVGHeight/centerOfFieldFactor - closeInfieldOffset + 15)
                .attr("text-anchor", "middle")
                .style("font-size", "18px")
                .style("fill", "#f6f9f9")
                .style("font-family", "Helvetica")
                .text("Batting");

            var bowlScoreAreaLabel = cricketField.append("text")
                .attr("x", fieldSVGWidth/centerOfFieldFactor + 55)
                .attr("y", fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset + -6)
                .attr("text-anchor", "middle")
                .style("font-size", "18px")
                .style("fill", "#f6f9f9")
                .style("font-family", "Helvetica")
                .text("Bowling");


            var bowlScoreAreaLabelMeasure = cricketField.append("text")
                .attr("id","bowlScoreAreaLabelMeasure")
                .attr("x", fieldSVGWidth/centerOfFieldFactor)
                .attr("y", fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset + 90)
                .attr("text-anchor", "middle")
                .style("font-size", "12px")
                .style("fill", "#f6f9f9")
                .style("font-family", "Helvetica")
                .text(d3.select("#bowlMeasureFilterSelection").property("value")+": "+(batScore[0].values.BowlScore).toFixed(2));

            var bowlScoreAreaLabelAvg = cricketField.append("text")
                .attr("id","bowlScoreAreaLabelAvg")
                .attr("x", fieldSVGWidth/centerOfFieldFactor)
                .attr("y", fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset + 105)
                .attr("text-anchor", "middle")
                .style("font-size", "12px")
                .style("fill", "#f6f9f9")
                .style("font-family", "Helvetica")
                .text("League Avg: "+(batScore[0].values.BowlScoreAggAvg).toFixed(2));

            var bowlScoreAreaLabelSd = cricketField.append("text")
                .attr("id","bowlScoreAreaLabelSd")
                .attr("x", fieldSVGWidth/centerOfFieldFactor)
                .attr("y", fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset + 120)
                .attr("text-anchor", "middle")
                .style("font-size", "12px")
                .style("fill", "#f6f9f9")
                .style("font-family", "Helvetica")
                .text("League Std Dev: "+(batScore[0].values.BowlScoreAggSd).toFixed(2));

            var batScoreAreaLabelMeasure = cricketField.append("text")
                .attr("id","batScoreAreaLabelMeasure")
                .attr("x", fieldSVGWidth/centerOfFieldFactor)
                .attr("y", fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset - 185)
                .attr("text-anchor", "middle")
                .style("font-size", "12px")
                .style("fill", "#f6f9f9")
                .style("font-family", "Helvetica")
                .text(d3.select("#batMeasureFilterSelection").property("value")+": "+(batScore[0].values.BatScore).toFixed(2));

            var batScoreAreaLabelAvg = cricketField.append("text")
                .attr("id","batScoreAreaLabelAvg")
                .attr("x", fieldSVGWidth/centerOfFieldFactor)
                .attr("y", fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset - 170)
                .attr("text-anchor", "middle")
                .style("font-size", "12px")
                .style("fill", "#f6f9f9")
                .style("font-family", "Helvetica")
                .text("League Avg: "+(batScore[0].values.BatScoreAggAvg).toFixed(2));

            var batScoreAreaLabelSd = cricketField.append("text")
                .attr("id","batScoreAreaLabelSd")
                .attr("x", fieldSVGWidth/centerOfFieldFactor)
                .attr("y", fieldSVGHeight/centerOfFieldFactor + closeInfieldOffset - 155)
                .attr("text-anchor", "middle")
                .style("font-size", "12px")
                .style("fill", "#f6f9f9")
                .style("font-family", "Helvetica")
                .text("League Std Dev: "+(batScore[0].values.BatScoreAggSd).toFixed(2));


            // half circle variables
            var start = -.5 * Math.PI;
            var size = Math.PI;
            var startbottom = .5 * Math.PI;

            var arcTop = d3.svg.arc()
                .innerRadius(0)
                .outerRadius(75)
                .startAngle(start)
                .endAngle(start + size);

            var chart = cricketField.append("svg")
                .attr("width", 420)
                .attr("height", 420).append("svg:g")
                .attr("transform", "translate(250,264)");

            chart.selectAll("path")
                .data(batScore)
                .enter().append("svg:path")
                .style("opacity", scoreAreaOpacity)
                .style("fill", batScoreColor)
                .attr("id", "arcTop")
                .attr("d", arcTop)
                .attr("stroke", batScoreColor)
                .style("stroke-width", 2);

            var arcBottom = d3.svg.arc()
                .innerRadius(0)
                .outerRadius(75)
                .startAngle(startbottom)
                .endAngle(startbottom + size);

            var chartBottom = cricketField.append("svg")
                .attr("width", 420)
                .attr("height", 420).append("svg:g")
                .attr("transform", "translate(250,336)");

            chartBottom.selectAll("path")
                .data(batScore)
                .enter().append("svg:path")
                .style("opacity", scoreAreaOpacity)
                .style("fill",  bowlScoreColor )
                .attr("stroke", bowlScoreColor)
                .attr("id", "arcBottom")
                .attr("d", arcBottom);

            // var fieldScoreColor = getFieldingScoreColor(batScore);
            // cricketField.append("ellipse")
            //     .attr("id","fieldScoreArea")
            //     .attr("cx", fieldSVGWidth/centerOfFieldFactor)
            //     .attr("cy", fieldSVGHeight/centerOfFieldFactor)
            //     .attr("rx", fieldSVGWidth/2.5)
            //     .attr("ry", (fieldSVGHeight/2.5)/outfieldShapeFactor )
            //     .style("opacity", scoreAreaOpacity)
            //     .attr("stroke", fieldScoreColor)
            //     .style("stroke-width", 65)
            //     .attr("fill", "none" );

        }

        function updateStats() {
            d3.select("#bowlScoreAreaLabelMeasure").text(d3.select("#bowlMeasureFilterSelection").property("value")+": "+(batScore[0].values.BowlScore).toFixed(2));
            d3.select("#bowlScoreAreaLabelAvg").text("League Avg: "+(batScore[0].values.BowlScoreAggAvg).toFixed(2));
            d3.select("#bowlScoreAreaLabelSd").text("League Std Dev: "+(batScore[0].values.BowlScoreAggSd).toFixed(2));
            d3.select("#batScoreAreaLabelMeasure").text(d3.select("#batMeasureFilterSelection").property("value")+": "+(batScore[0].values.BatScore).toFixed(2));
            d3.select("#batScoreAreaLabelAvg").text("League Avg: "+(batScore[0].values.BatScoreAggAvg).toFixed(2));
            d3.select("#batScoreAreaLabelSd").text("League Std Dev: "+(batScore[0].values.BatScoreAggSd).toFixed(2));

        }


        d3.select("#yearFilterSelection").on("change", function(d) {

            var selectedOption = d3.select(this).property("value");
            filteredToYear = cricketdummy.filter(function(d){return d.Year == selectedOption;});
            var batScore = aggregateData();
            var batScoreColor = getBatScoreColor(batScore);
            var bowlScoreColor = getBowlScoreColor(batScore);
            var FieldingScoreColor = getFieldingScoreColor(batScore);
            d3.select("#arcTop").attr("stroke", batScoreColor).style("fill",  batScoreColor );
            d3.select("#arcBottom").attr("stroke", bowlScoreColor).style("fill",  bowlScoreColor );
            d3.select("#fieldScoreArea").attr("stroke", FieldingScoreColor)

            d3.select("#bowlScoreAreaLabelMeasure").text(d3.select("#bowlMeasureFilterSelection").property("value")+": "+(batScore[0].values.BowlScore).toFixed(2));
            d3.select("#bowlScoreAreaLabelAvg").text("League Avg: "+(batScore[0].values.BowlScoreAggAvg).toFixed(2));
            d3.select("#bowlScoreAreaLabelSd").text("League Std Dev: "+(batScore[0].values.BowlScoreAggSd).toFixed(2));
            d3.select("#batScoreAreaLabelMeasure").text(d3.select("#batMeasureFilterSelection").property("value")+": "+(batScore[0].values.BatScore).toFixed(2));
            d3.select("#batScoreAreaLabelAvg").text("League Avg: "+(batScore[0].values.BatScoreAggAvg).toFixed(2));
            d3.select("#batScoreAreaLabelSd").text("League Std Dev: "+(batScore[0].values.BatScoreAggSd).toFixed(2));
        });
        d3.select("#batMeasureFilterSelection").on("change", function(d) {

            var batScore = aggregateData();
            var batScoreColor = getBatScoreColor(batScore);
            var bowlScoreColor = getBowlScoreColor(batScore);
            var FieldingScoreColor = getFieldingScoreColor(batScore);
            d3.select("#arcTop").attr("stroke", batScoreColor).style("fill",  batScoreColor );
            d3.select("#arcBottom").attr("stroke", bowlScoreColor).style("fill",  bowlScoreColor );
            d3.select("#fieldScoreArea").attr("stroke", FieldingScoreColor)

            d3.select("#bowlScoreAreaLabelMeasure").text(d3.select("#bowlMeasureFilterSelection").property("value")+": "+(batScore[0].values.BowlScore).toFixed(2));
            d3.select("#bowlScoreAreaLabelAvg").text("League Avg: "+(batScore[0].values.BowlScoreAggAvg).toFixed(2));
            d3.select("#bowlScoreAreaLabelSd").text("League Std Dev: "+(batScore[0].values.BowlScoreAggSd).toFixed(2));
            d3.select("#batScoreAreaLabelMeasure").text(d3.select("#batMeasureFilterSelection").property("value")+": "+(batScore[0].values.BatScore).toFixed(2));
            d3.select("#batScoreAreaLabelAvg").text("League Avg: "+(batScore[0].values.BatScoreAggAvg).toFixed(2));
            d3.select("#batScoreAreaLabelSd").text("League Std Dev: "+(batScore[0].values.BatScoreAggSd).toFixed(2));
        });
        d3.select("#bowlMeasureFilterSelection").on("change", function(d) {

            var batScore = aggregateData();
            var batScoreColor = getBatScoreColor(batScore);
            var bowlScoreColor = getBowlScoreColor(batScore);
            var FieldingScoreColor = getFieldingScoreColor(batScore);
            d3.select("#arcTop").attr("stroke", batScoreColor).style("fill",  batScoreColor );
            d3.select("#arcBottom").attr("stroke", bowlScoreColor).style("fill",  bowlScoreColor );
            d3.select("#fieldScoreArea").attr("stroke", FieldingScoreColor)

            d3.select("#bowlScoreAreaLabelMeasure").text(d3.select("#bowlMeasureFilterSelection").property("value")+": "+(batScore[0].values.BowlScore).toFixed(2));
            d3.select("#bowlScoreAreaLabelAvg").text("League Avg: "+(batScore[0].values.BowlScoreAggAvg).toFixed(2));
            d3.select("#bowlScoreAreaLabelSd").text("League Std Dev: "+(batScore[0].values.BowlScoreAggSd).toFixed(2));
            d3.select("#batScoreAreaLabelMeasure").text(d3.select("#batMeasureFilterSelection").property("value")+": "+(batScore[0].values.BatScore).toFixed(2));
            d3.select("#batScoreAreaLabelAvg").text("League Avg: "+(batScore[0].values.BatScoreAggAvg).toFixed(2));
            d3.select("#batScoreAreaLabelSd").text("League Std Dev: "+(batScore[0].values.BatScoreAggSd).toFixed(2));
        });
        d3.select("#teamFilterSelection").on("change", function(d) {

            var batScore = aggregateData();
            var scatterData = aggregateDataScatter();
            var batScoreColor = getBatScoreColor(batScore);
            var bowlScoreColor = getBowlScoreColor(batScore);
            var FieldingScoreColor = getFieldingScoreColor(batScore);
            d3.select("#arcTop").attr("stroke", batScoreColor).style("fill",  batScoreColor );
            d3.select("#arcBottom").attr("stroke", bowlScoreColor).style("fill",  bowlScoreColor );
            d3.select("#fieldScoreArea").attr("stroke", FieldingScoreColor)

            d3.select("#bowlScoreAreaLabelMeasure").text(d3.select("#bowlMeasureFilterSelection").property("value")+": "+(batScore[0].values.BowlScore).toFixed(2));
            d3.select("#bowlScoreAreaLabelAvg").text("League Avg: "+(batScore[0].values.BowlScoreAggAvg).toFixed(2));
            d3.select("#bowlScoreAreaLabelSd").text("League Std Dev: "+(batScore[0].values.BowlScoreAggSd).toFixed(2));
            d3.select("#batScoreAreaLabelMeasure").text(d3.select("#batMeasureFilterSelection").property("value")+": "+(batScore[0].values.BatScore).toFixed(2));
            d3.select("#batScoreAreaLabelAvg").text("League Avg: "+(batScore[0].values.BatScoreAggAvg).toFixed(2));
            d3.select("#batScoreAreaLabelSd").text("League Std Dev: "+(batScore[0].values.BatScoreAggSd).toFixed(2));
            d3.select("#ScatterPlotSVG").remove();
            drawScatterPlot()


        });
        drawCricketField();



        function drawScatterPlot() {
            var scatterData = aggregateDataScatter()
            var margin = {top: 20, right: 20, bottom: 30, left: 40},
                width = 500 - margin.left - margin.right,
                height = 325 - margin.top - margin.bottom;

// setup x
            var xValue = function(d) { return d.values.MatchesWon;},
                xScale = d3.scale.linear().range([0, width]),
                xMap = function(d) { return xScale(xValue(d));},
                xAxis = d3.svg.axis().scale(xScale).orient("bottom");

// setup y
            var yValue = function(d) { return d.values.ScatterMeasure;},
                yScale = d3.scale.linear().range([height, 0]),
                yMap = function(d) { return yScale(yValue(d));},
                yAxis = d3.svg.axis().scale(yScale).orient("left");

// setup fill color
            var cValue = function(d) { return d.Team;},
                color = d3.scale.category10();

// add the graph canvas to the body of the webpage
            var svg = d3.select("#scatterPlot").append("svg")
                .attr("id","ScatterPlotSVG")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// add the tooltip area to the webpage
            var tooltip = d3.select("#scatterPlot").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);


            cricketdummy.forEach(function(d) {
                d.BowlingEconomy = +d.BowlingEconomy;
                d.won = +d.won;
            });

            xScale.domain([d3.min(scatterData, xValue)-1, d3.max(scatterData, xValue)+1]);
            yScale.domain([d3.min(scatterData, yValue)-1, d3.max(scatterData, yValue)+1]);

            // x-axis
            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis)
                .append("text")
                .attr("class", "label")
                .attr("x", width)
                .attr("y", -6)
                .style("text-anchor", "end")
                .text("Matches Won");

            // y-axis
            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("class", "label")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Wickets Per Match");

            // draw dots
            svg.selectAll(".dot")
                .data(scatterData)
                .enter().append("circle")
                .attr("id","scatterUpdate")
                .attr("class", "dot")
                .attr("r", 7.5)
                .attr("cx", xMap)
                .attr("cy", yMap)
                .style("fill", function(d) { return color(cValue(d));})
                .on("mouseover", function(d) {
                    d3.select(this)
                        .transition()
                        .duration(500)
                        .attr('r',20)
                        .attr('stroke-width',3)
                })
                .on("mouseout", function(d) {
                    d3.select(this)
                        .transition()
                        .duration(500)
                        .attr('r',7.5)
                        .attr('stroke-width',1)
                })
                .append('title') // Tooltip
                .text(function (d) { return d.key +
                    '\nMatches Won: ' + d.values.MatchesWon +
                    '\nWickets Per Match: ' + d.BowlingEconomy +
                    '\nAvg Runs Scored: ' + d.values.ScatterMeasure})


        }
        drawScatterPlot()
        drawMapLegend()
    });



</script>
</body>
</html>
